trigger:
- development

# ‚è∞ Daily 1:30 AM
schedules:
- cron: "30 1 * * *"
  displayName: Node Nightly Build
  branches:
    include:
      - development
  always: true

# -------------------------
# PARAMETERS
# -------------------------
parameters:
- name: nodeVersion
  type: string
  default: '20'

# -------------------------
# VARIABLES
# -------------------------
variables:
  NODE_ENV: 'development'
  APP_NAME: 'node-app'

# -------------------------
# AGENT (Same as Java)
# -------------------------
pool:
  name: agentjan10
  demands:
    - node

# =========================
# STEPS
# =========================
steps:
- script: |
    echo "Setting Node Version"
    node -v
    npm -v
  displayName: "Verify Node & NPM"

- script: |
    echo "Installing dependencies"
    npm install
    npm run build --if-present
    npm test --if-present
  displayName: "NPM Build & Test"
  env:
    NODE_ENV: $(NODE_ENV)

- task: PublishPipelineArtifact@1
  inputs:
    targetPath: '.'
    artifact: 'node-package'
    publishLocation: 'pipeline'
  displayName: "Publish Node Artifact"

