trigger:
- development

# ‚è∞ Daily 1:30 AM
schedules:
- cron: "30 1 * * *"
  displayName: Node Nightly Build
  branches:
    include:
      - development
  always: true

parameters:
- name: nodeVersion
  type: string
  default: '20'

variables:
  NODE_ENV: 'development'
  APP_NAME: 'node-app'

pool:
  name: agentjan10
  # demands:      # Remove demands here to avoid failure
  #  - node

steps:
- task: NodeTool@0
  inputs:
    versionSpec: ${{ parameters.nodeVersion }}
  displayName: "Install Node.js"

- script: |
    node -v
    npm -v
  displayName: "Verify Node & NPM"

- script: |
    npm install
    npm run build --if-present
    npm test --if-present
  displayName: "NPM Build & Test"
  env:
    NODE_ENV: $(NODE_ENV)

- task: PublishPipelineArtifact@1
  inputs:
    targetPath: '.'
    artifact: 'node-package'
    publishLocation: 'pipeline'
  displayName: "Publish Node Artifact"


